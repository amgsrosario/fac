--alter table usuario add column email varchar (150) not null,

create table codpostal(
	id varchar(20) not null primary key,
	nome varchar(50) not null
);

create table moeda(
    id varchar(3) not null primary key,
    nome varchar(30) not null,
    vcompra numeric (20,10),
    vvenda numeric (20,10),
    simbolo varchar (5) not null,
    ndecimais int not null,
    ciso varchar (10)
);

create table mpagamento(
	id integer generated by default as identity primary key not null,
	nome varchar(30) not null
);

create table ppagamento(
	id integer generated by default as identity primary key not null,
	nome varchar(30) not null,
	dias integer not null
);

create table ivasaft(
	id varchar(3) not null primary key,
	nome varchar(50) not null
);

create table misencao(
    id varchar(3) not null primary key,
	nome varchar(60) not null,
	id_ivasaft varchar(4) not null references ivasaft(id)
);

create table riva(
    id varchar(3) not null primary key,
	nome varchar(30) not null,
	isenta numeric(4,2) not null,
	reduzida numeric(4,2) not null,
	intermedia numeric(4,2) not null,
	normal numeric(4,2) not null
);

create table transporte(
    id integer generated by default as identity primary key not null,
    nome varchar(30) not null
);

create table pais(
	id varchar(3) not null primary key,
	nome varchar(50) not null
);

create table cliente(
    id bigint generated by default as identity primary key not null,
    nome varchar(80)not null,
    morada varchar(60)not null,
    morada1 varchar(60),
    localidade varchar(50),
    id_codpostal varchar(20)not null references codpostal(id),
    nif varchar(20)not null ,
    id_moeda varchar(3) not null references moeda(id),
    tel varchar (20),
    tm varchar (20),
    email varchar (120),
    email1 varchar (120),
    id_mpagamento integer references mpagamento(id),
    id_ppagamento integer references ppagamento(id),
    id_riva varchar(3) references riva(id),
    tspiva varchar (20),
    iban varchar (34),
    retencao boolean not null default false,
    id_transporte integer references transporte(id),
    inativo boolean not null default false,
    observacoes varchar(300)
  --CONSTRAINT uk_cliente_nif
);



create table morada(
    id bigint generated by default as identity primary key not null,
    id_cliente bigint not null references cliente(id),
    nome varchar(80)not null,
    morada varchar(60)not null,
    morada1 varchar(60),
    localidade varchar(50),
    id_codpostal varchar(20)not null references codpostal(id),
    tipo varchar(20) not null,
    principal boolean not null default false,
    inativo boolean not null default false
);

create index ix_morada_cliente on morada(id_cliente);
create index ix_morada_codpostal on morada(id_codpostal);
create index ix_cliente_codpostal on cliente(id_codpostal);
create index ix_cliente_moeda on cliente(id_moeda);
create index ix_cliente_mpagamento on cliente(id_mpagamento);
create index ix_cliente_ppagamento on cliente(id_ppagamento);
create index ix_cliente_riva on cliente(id_riva);
create index ix_cliente_transporte on cliente(id_transporte);





CREATE EXTENSION IF NOT EXISTS "uuid-ossp"


#password='admin123'
insert into usuario
(id, login, senha, email, roles)
values
(uuid_generate_v4(), 'gerente', '$2a$12$eCiDxNUl3ZGtZMi0/.PP3O6OLjB5/EeCrk62IWzgXZ49psKvD58IC', 'gerente@email.com', '{GERENTE}')

#password='secret-production'
insert into client
(id, client_id, client_secret, redirect_uri, scope)
values
(uuid_generate_v4(), 'client-production', '$2a$12$cRWAY6.2ZGhxFZ47WcLXnueh25QpCqxj4pWojjYlIC1dOdLZklj6u', 'http://locahost:8080/authorized', 'GERENTE' )

insert into moeda(
    id ,
    nome,
    vcompra,
    vvenda,
    simbolo,
    ndecimais,
    ciso
)
value
('EUR', 'EURO', 1, 1, 'â‚¬', 2, '012')